version: '3.3'
services:
  object-detector:
    image: $APP_NAME
    network_mode: bridge
    links:
      - inference-server
    privileged: true
    ipc: host
    environment:
      - INFERENCE_HOST=inference-server
      - INFERENCE_PORT=8501
      - MODEL_PATH=/models/ssd_mobilenet_v2_coco_quant_postprocess_edgetpu.tflite
      - OBJECT_LIST_PATH=/models/coco_labels.txt
    volumes:
      - acap_dl-models:/models:ro
      - /var/run/dbus:/var/run/dbus:rw

  inference-server:
    image: axisecp/larod-inference-server:2.4.0.test-api.4.0-pre6-armv7hf-ubuntu20.04
    network_mode: bridge
    command: /usr/bin/larod-inference-server -p 8501 -j 4 -c testdata/server.pem -k testdata/server.key
    privileged: true
    ipc: host
    volumes:
      - acap_dl-models:/models
      - /run/dbus/system_bus_socket:/run/dbus/system_bus_socket

  acap_dl-models:
    image: $MODEL_NAME
    volumes:
      - acap_dl-models:/models

volumes:
  acap_dl-models: {}
